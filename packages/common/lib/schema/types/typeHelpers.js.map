{"version":3,"sources":["../../../src/schema/types/typeHelpers.js"],"names":["getSafeFieldParser","tryParse","defaultValueFunctions","field","record","name","getSafeValueParser","getUndefinedValue","value","parsed","success","getNewValue","getInitialValue","typeFunctions","specificFunctions","constant","validateTypeConstraints","validationRules","fieldValue","validateRule","r","isValid","typeOptions","getMessage","errors","err","push","getDefaultOptions","v","defaultValue","makerule","parsedFailed","val","parsedSuccess","getDefaultExport","functions","options","sampleValue","stringify","getNew","safeParseField","safeParseValue","optionDefinitions","undefined","getDefaultValue"],"mappings":"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","sourcesContent":["import { merge } from \"lodash\"\nimport { constant, isUndefined, has, mapValues, cloneDeep } from \"lodash/fp\"\nimport { isNotEmpty } from \"../../common/index.js\"\n\nexport const getSafeFieldParser = (tryParse, defaultValueFunctions) => (\n  field,\n  record\n) => {\n  if (has(field.name)(record)) {\n    return getSafeValueParser(\n      tryParse,\n      defaultValueFunctions\n    )(record[field.name])\n  }\n  return defaultValueFunctions[field.getUndefinedValue]()\n}\n\nexport const getSafeValueParser = (\n  tryParse,\n  defaultValueFunctions\n) => value => {\n  const parsed = tryParse(value)\n  if (parsed.success) {\n    return parsed.value\n  }\n  return defaultValueFunctions.default()\n}\n\nexport const getNewValue = (tryParse, defaultValueFunctions) => field => {\n  const getInitialValue =\n    isUndefined(field) || isUndefined(field.getInitialValue)\n      ? \"default\"\n      : field.getInitialValue\n\n  return has(getInitialValue)(defaultValueFunctions)\n    ? defaultValueFunctions[getInitialValue]()\n    : getSafeValueParser(tryParse, defaultValueFunctions)(getInitialValue)\n}\n\nexport const typeFunctions = specificFunctions =>\n  merge(\n    {\n      value: constant,\n      null: constant(null),\n    },\n    specificFunctions\n  )\n\nexport const validateTypeConstraints = validationRules => (field, record) => {\n  const fieldValue = record[field.name]\n  const validateRule = r =>\n    !r.isValid(fieldValue, field.typeOptions)\n      ? r.getMessage(fieldValue, field.typeOptions)\n      : \"\"\n\n  const errors = []\n  for (const r of validationRules) {\n    const err = validateRule(r)\n    if (isNotEmpty(err)) errors.push(err)\n  }\n\n  return errors\n}\n\nconst getDefaultOptions = mapValues(v => v.defaultValue)\n\nexport const makerule = (isValid, getMessage) => ({ isValid, getMessage })\nexport const parsedFailed = val => ({ success: false, value: val })\nexport const parsedSuccess = val => ({ success: true, value: val })\nexport const getDefaultExport = (\n  name,\n  tryParse,\n  functions,\n  options,\n  validationRules,\n  sampleValue,\n  stringify\n) => ({\n  getNew: getNewValue(tryParse, functions),\n  safeParseField: getSafeFieldParser(tryParse, functions),\n  safeParseValue: getSafeValueParser(tryParse, functions),\n  tryParse,\n  name,\n  getDefaultOptions: () => getDefaultOptions(cloneDeep(options)),\n  optionDefinitions: options,\n  validateTypeConstraints: validateTypeConstraints(validationRules),\n  sampleValue,\n  stringify: val => (val === null || val === undefined ? \"\" : stringify(val)),\n  getDefaultValue: functions.default,\n})\n"],"file":"typeHelpers.js"}